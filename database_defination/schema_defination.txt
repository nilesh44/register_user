


#create schema demo;
drop schema if exists login_mgt_2;
create schema login_mgt_2;
use login_mgt_2;


CREATE TABLE user_prefer_code (
     user_prefer_id  VARCHAR(05) NOT NULL ,
     user_prefer_type char(01),
	 user_prefer_desc VARCHAR(20),
     crt_tms timestamp not null,
     exp_tms timestamp,
     constraint user_prefer_id_pk primary key(user_prefer_id)
);

insert into user_prefer_code(user_prefer_id,user_prefer_type,user_prefer_desc,crt_tms,exp_tms) values('01','P','primary',now(),null);
insert into user_prefer_code(user_prefer_id,user_prefer_type,user_prefer_desc,crt_tms,exp_tms) values('02','S','secondary',now(),null);


CREATE TABLE int_user (
    int_user_id  INTEGER NOT NULL AUTO_INCREMENT,
    is_block char(01) default 'N',
    crt_tms      TIMESTAMP ,
    exp_tms      TIMESTAMP,
	by_user      VARCHAR(50),	
	constraint int_user_pk PRIMARY KEY (int_user_id,crt_tms)
   
);

CREATE TABLE user_cred (
    user_cred_id  INTEGER NOT NULL AUTO_INCREMENT ,
    int_user_id   INTEGER ,
    user_name     VARCHAR(20),
    user_password     VARCHAR(20),
    is_block char(01) default 'N',
	crt_tms      TIMESTAMP ,
    exp_tms      TIMESTAMP,
	by_user      VARCHAR(50),
	constraint user_cred_pk PRIMARY KEY (user_cred_id,crt_tms),
	CONSTRAINT int_user_user_credentials FOREIGN KEY (int_user_id) REFERENCES int_user(int_user_id)
);

CREATE TABLE email_details (
    email_id     INTEGER NOT NULL AUTO_INCREMENT,  
    int_user_id  INTEGER NOT NULL,    
    email_addr   VARCHAR(50) NOT NULL,  
    is_block char(01) default 'N',
    user_prefer_code varchar(05) NOT NULL,
	crt_tms      TIMESTAMP ,
    exp_tms      TIMESTAMP,
	by_user      VARCHAR(50),
	constraint email_details_pk PRIMARY KEY (email_id,crt_tms),
	
     CONSTRAINT int_user_email_details FOREIGN KEY (int_user_id) REFERENCES int_user(int_user_id),
     CONSTRAINT user_prefer_code_email_details FOREIGN KEY (user_prefer_code) REFERENCES user_prefer_code(user_prefer_id)
	 
);

CREATE TABLE mobile_details (
    mob_id     INTEGER NOT NULL AUTO_INCREMENT ,
    int_user_id  INTEGER NOT NULL,
    mob_num    VARCHAR(10) NOT NULL,
    cntry_code      VARCHAR(5),
    is_block char(01) default 'N', 
    user_prefer_code varchar(05) NOT NULL,
	crt_tms      TIMESTAMP ,
    exp_tms      TIMESTAMP,
	by_user      VARCHAR(50),
	constraint mobile_details_pk PRIMARY KEY (phone_id,crt_tms),

     CONSTRAINT int_user_phone_details FOREIGN KEY (int_user_id) REFERENCES int_user(int_user_id),
	 CONSTRAINT user_prefer_code_phone_details FOREIGN KEY (user_prefer_code) REFERENCES user_prefer_code(user_prefer_id)
);

CREATE TABLE personal_info (
   prsnl_info_id   INTEGER NOT NULL AUTO_INCREMENT ,
   int_user_id       INTEGER NOT NULL,
   first_name        VARCHAR(50),
   last_name         VARCHAR(50),
   dob               DATE,
   is_block  char(01) default 'N',
   crt_tms      TIMESTAMP ,
   exp_tms      TIMESTAMP,
   by_user      VARCHAR(50),
   
   constraint prsnl_info_id_pk PRIMARY KEY (prsnl_info_id,crt_tms),
   CONSTRAINT int_user_personal_info FOREIGN KEY (int_user_id) REFERENCES int_user(int_user_id)
   
);

CREATE TABLE user_session (
     user_session_id  INTEGER NOT NULL AUTO_INCREMENT ,
     int_user_id   INTEGER not null ,
     user_name VARCHAR(20),
     crt_tms timestamp not null,
     last_login_tms timestamp not null,
	 is_expired char(01) default 'N',
	 
	 CONSTRAINT int_user_user_session FOREIGN KEY (int_user_id) REFERENCES int_user(int_user_id),
     constraint USER_session_pk primary key(user_session_id,crt_tms)
);


commit ;


select * from int_user;
select * from user_cred;
select * from email_details;
select * from mobile_details;
select * from user_session;
select * from user_prefer_code;